<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéµ Your Mood Song</title><link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="song-page">
  <header class="top-bar">
    <button class="song-btn" onclick="goBack()">‚Üêback</button>
    <button class="btn history-btn" onclick="goHistory()">History</button>
    <button class="btn all-btn" onclick="goAllSongs()">All Songs</button>
  </header>

  <main class="song-container">
    <h2 id="song-title">Loading‚Ä¶</h2>
    <audio id="audio-player" controls></audio>
    <p id="mez-message" class="mez"></p>
    <button onclick="dontLikeSong()">Don't Like</button>
  </main>

  <script>
  const songs = [
    {
      name: "Kabhi kabhi Aditi",
      file: "Kabhi kabhi Aditi 1.mp3",
      tags: ["Happy", "lonely"],
      intensities: [7, 3],
      mez: "Ohh Happy Happy why mujhe bhi to batta jo bhi ha tu kush ha to lagge jha ma chai ha kushi" ,
      bg: "happy.jpg"
    },
    {
      name: "Kabhi kabhi Aditi",
      file: "Kabhi kabhi Aditi 2.mp3",
      tags: ["sad", "lonely"],
      intensities: [6, 7],
      mez: "You are not alone pgl nonsense just thodi der ka liya Shanti milli ha dharmik ko wapus kr dena warna wo bawal kr de ga",
      bg: "sad1.jpg"
    },
    {
      name: "Kabhi kabhi Aditi",
      file: "Kabhi kabhi Aditi 3.mp3",
      tags: ["sad", "lonely"],
      intensities: [5, 7],
      mez: " Bro why you are sad you shouldn't be sad EVERY THING GONNA BE OKAY",
      bg: "chill1.jpg"
    },
    {
      name: "Befikra",
      file: "Befikra.mp3",
      tags: ["chill", "comforting"],
      intensities: [7,6],
      mez: "Enjoy üòÄü§åüí´",
      bg: "chill1.jpg"
    },
     {
      name: "Tum hi ho bandu",
      file: "Tum Hi Ho Bandhu.mp3",
      tags: ["chill", "happy"],
      intensities: [6,8],
      mez: "Enjoy nonsense üòõüòõüòúü§™",
      bg: "chill1.jpg"
       }, {
      name: "Ik kudi",
      file: "Ik kudi.mp3",
      tags: ["chill", "happy"],
      intensities: [7,7],
      mez: "Chamishüëìüëì",
      bg: "chill2.jpg"
    }, {
      name: "Doob Jane ko",
      file: "Aankhon Mein Doob Jaane Ko.mp3",
      tags: ["Love","chill"],
      intensities: [5,7],
      mez: "Enjoy üòäüòÄ",
      bg: "chill2.jpg"
    }, {
      name: "Saudabaji",
      file: "saudebaazi.mp3",
      tags: ["lonely","comforting"],
      intensities: [6,7],
      mez: "From the bottom of my heart ü§ç",
      bg: "lonely1.jpg"
    }, {
  name: "Hawayein",
  file: "Hawayein.mp3",
  tags: ["love", "comforting"],
  intensities: [2, 4],
  mez: "la jya jane kha hawayein hawayein üí´",
  bg: "comfort2.jpg"
},
{
  name: "Mere Liye Tum Kaafi Ho",
  file: "Mere Liye Tum Kaafi Ho.mp3",
  tags: ["love", "comforting"],
  intensities: [2, 3],
  mez: "ye dil ha dhala teri aadat ma üòÅ",
  bg: "comfort1.jpg"
},
{
  name: "ishq hai",
  file: "ishq hai.mp3",
  tags: ["love", "chill"],
  intensities: [3, 4],
  mez: "vibe of romanceüëÄ",
  bg: "White.jpg"
},
{
  name: "ishq hai",
  file: "ishq hai 2.mp3",
  tags: ["love", "chill"],
  intensities: [3, 4],
  mez: "vibe of romanceüëÄ",
  bg: "White.jpg"
},
{
  name: "hosanna",
  file: "hosanna.mp3",
  tags: ["love", "sad"],
  intensities: [6, 3],
  mez: "Hossana true‚ú®",
  bg: "sad2.jpg"
},
{
  name: "Savera",
  file: "Savera.mp3",
  tags: ["comforting", "happy"],
  intensities: [3, 5],
  mez: "ha tere jasa na koi tu hi to Lakho ma hai tere jasa na koiü§å",
  bg: "white.jpg"
},
{
  name: "Badtameez Dil",
  file: "Badtameez Dil.mp3",
  tags: ["happy", "chill"],
  intensities: [6, 7],
  mez: "badtameez dil badtameez dill mane naü§™üéà",
  bg: "love2.jpg"
},
{
  name: "Love You Zindagi",
  file: "Love You Zindagi.mp3",
  tags: ["sad", "comforting"],
  intensities: [6, 6],
  mez: "kha do muskurat ko hi hi hi üëã",
  bg: "comfort.jpg"
},
{
  name: "Character Dheela",
  file: "Character Dheela.mp3",
  tags: ["happy", "chill"],
  intensities: [6, 7],
  mez: "quirky fun and swag",
  bg: "chill5.jpg"
},
{
  name: "One Two Three Four",
  file: "One Two Three Four.mp3",
  tags: ["happy", "chill"],
  intensities: [7, 8],
  mez: "picha kuaa aaga mera khai tu hi bata jau ma kha?üôè",
  bg: "chill3.jpg"
}, {
      name: "Agar Tum Saath Ho",
      file: "Agar Tum Saath Ho.mp3",
      tags: ["sad", "lonely"],
      intensities: [7, 6],
      mez: "you know this is my one of favourite songsü•Ä",
      bg: "sad1.jpg"
    }, {
      name: "Ilahi",
      file: "Ilahi.mp3",
      tags: ["happy", "comforting"],
      intensities: [7, 5],
      mez: "CHALA MA JHA LA CHALA RASTA‚úåÔ∏è",
      bg: "happy1.jpg"
    }, {
      name: "Matargashti",
      file: "Matargashti.mp3",
      tags: ["chill", "happy"],
      intensities: [7,8],
      mez: "Gela hua ha jo sukhana ho ga kyu ki ha yee chirkut zindagi",
      bg: "chill1.jpg"
    }, {
      name: "Way Back Home",
      file: "Way Back Home.mp3",
      tags: ["lonely", "sad"],
      intensities: [9, 4],
      mez: "your never be alone you'll always find me by your side üò™",
      bg: "lonely1.jpg"
    }, {
      name: "Tera Yaar Hoon Main",
      file: "Tera Yaar Hoon Main.mp3",
      tags: ["love", "comforting"],
      intensities: [6, 7],
      mez: "Haak nahi tu yee kahe ki yrrr ham ab na rahaü•∫",
      bg: "Comfort2.jpg"
    }, {
      name: "Timro-Pratiksha",
      file: "Timro-Pratiksha.mp3",
      tags: ["lonely", "comforting"],
      intensities: [6,5],
      mez: "nepali song hai but achha hai na??",
      bg: "moon.jpg"
    }, {
      name: "Ratiyaan",
      file: "Ratiyaan.mp3",
      tags: ["lonely", "comforting"],
      intensities: [7, 8],
      mez: "üò¥üò™soja nonsense Good night bothra ",
      bg: "moon.jpg"
    }, {
      name: "Radha-Rani-Lage",
      file: "Radha-Rani-Lage.mp3",
      tags: ["sad", "comforting"],
      intensities: [4,6],
      mez: "sweet songü§åüí´",
      bg: "sad1.jpg"
    }, {
      name: "alone",
      file: "alone.mp3",
      tags: ["sad", "lonely"],
      intensities: [4, 4],
      mez: "üíø",
      bg: "sad2.jpg"
    }, {
      name: "pata nahi",
      file: "pata nahi.mp3",
      tags: ["chill", "love"],
      intensities: [4, 4],
      mez: "ü§îü§î",
      bg: "happy.jpg"
    }, {
      name: "chor",
      file: "chor.mp3",
      tags: ["comforting", "sad"],
      intensities: [7, 5],
      mez: "mera favourite song hai‚ù§Ô∏è",
      bg: "moon.jpg"
    }, {
      name: "Hum Mar Jayenge",
      file: "Hum Mar Jayenge.mp3",
      tags: ["comforting", "love"],
      intensities: [2, 6],
      mez: "long song but dense emotions ü§åü•Ä",
      bg: "comfort.jpg"
    },{
  name: "Rang Lageya",
  file: "Rang Lageya.mp3",
  tags: ["love", "comforting"],
  intensities: [8, 7],
  mez: "Must listen song ha broo  üé®",
  bg: "rang.jpg"
},
{
  name: "Sawaar Loon",
  file: "Sawaar loon.mp3",
  tags: ["love", "happy"],
  intensities: [7, 6],
  mez: "Why you in happy/love mood ye mujhse tu na chupya jaldi se mez kr ka batyaüíÉ",
  bg: "love.jpg"
},
{
  name: "Raabta",
  file: "Raabta.mp3",
  tags: ["love", "comforting"],
  intensities: [6, 5],
  mez: "Whatever happens it happens for a reason üíû",
  bg: "comfort.jpg"
},
{
  name: "Chammak Challo",
  file: "Chammak Challo.mp3",
  tags: ["happy", "chill"],
  intensities: [9, 7],
  mez: "oye aja tu nach ka dikha üî•",
  bg: "chil.jpg"
},
{
  name: "Paaro",
  file: "Paaro.mp3",
  tags: ["lonely", "sad"],
  intensities: [7, 6],
  mez: "Sorry worng song its worth of listening",
  bg: "headphone.jpg"
},
{
  name: "Channa Mereya",
  file: "Channa Mereya.mp3",
  tags: ["sad", "lonely"],
  intensities: [9, 8],
  mez: " Achha chalta hu duaoo ma yadd rakhna mere zikar ka zuba par swad rakhna üíî",
  bg: "sad.jpg"
},
{
  name: "Tera Hero Idhar Hai",
  file: "Tera Hero Idhar Hai.mp3",
  tags: ["happy", "chill"],
  intensities: [7, 6],
  mez: "Tera hero kidhar hai üòÇü§£?",
  bg: "smile.jpg"
},
{
  name: "Kabira",
  file: "Kabira.mp3",
  tags: ["lonely", "sad"],
  intensities: [4, 6],
  mez: "ohh my kabira man ja why to be sad yrrr",
  bg: "sad jpg"
},
{
  name: "Mast Magan",
  file: "Mast Magan.mp3",
  tags: ["comforting", "love"],
  intensities: [7, 2],
  mez: "üéßüé∂üé∂üé∂",
  bg: "headphone.jpg"
},
{
  name: "",
  file: ".mp3",
  tags: ["", ""],
  intensities: [, ],
  mez: "",
  bg: ""
},


{
  name: "Snap",
  file: "snap.mp3",
  tags: ["sad", "lonely"],
  intensities: [7, 8],
  mez: "Some parts of us break silently ‚Äî this song is about those pieces.",
  bg: "Lone.jpg"
},
{
  name: "A Thousand Years",
  file: "a-thousand-years.mp3",
  tags: ["love", "comforting"],
  intensities: [6, 7],
  mez: "For the love that waits ‚Äî no matter how long.",
  bg: "Moon.jpg"
},
{
  name: "Wanna Be Yours",
  file: "wanna-be-yours.mp3",
  tags: ["love", "lonely"],
  intensities: [6, 8],
  mez: "Saying everything without saying much ‚Äî that‚Äôs love.",
  bg: "White.jpg"
},
{
  name: "Dance Monkey",
  file: "dance-monkey.mp3",
  tags: ["happy", "chill"],
  intensities: [8, 9],
  mez: "Because sometimes, being weird is beautiful.",
  bg: "Smile.jpg"
},
{
  name: "Shapire",
  file: "shapire.mp3",
  tags: [ "happy", "chill"],
  intensities: [7, 8],
  mez: "That spark, those butterflies, and the smile you try to hide.",
  bg: "Happy.jpg"
},
{
  name: "Shape of You",
  file: "shape-of-you.mp3",
  tags: ["love", "happy"],
  intensities: [8, 9],
  mez: "Playful hearts in love ‚Äî that's the vibe.",
  bg: "Headphone.jpg"
},
{
  name: "Perfect",
  file: "perfect.mp3",
  tags: ["love", "comforting"],
  intensities: [6, 7],
  mez: "Because when it's real, it doesn‚Äôt have to be perfect to feel perfect.",
  bg: "Moon.jpg"
},
{
  name: "Your Eyes",
  file: "your-eyes.mp3",
  tags: ["love", "lonely"],
  intensities: [7, 8],
  mez: "Her silence speaks louder than her words.",
  bg: "White.jpg"
},
{
  name: "She Don‚Äôt Give A F**k",
  file: "she-dont-give.mp3",
  tags: ["lonely", "sad"],
  intensities: [9, 10],
  mez: "For the fire inside the ones who smile with a broken heart.",
  bg: "Sad.jpg"
},
{
  name: "Pyaar Hota Hai Kayi Baar",
  file: "pyaar-hota.mp3",
  tags: ["love", "chill"],
  intensities: [6, 7],
  mez: "Some love stories stay as chapters, not endings.",
  bg: "Chill.jpg"
},
{
  name: "Cherry Cherry Lady",
  file: "cherry-cherry-lady.mp3",
  tags: ["love", "happy"],
  intensities: [6, 8],
  mez: "Old-school hearts beat with timeless charm.",
  bg: "Happy.jpg"
}
    // Add more songs here
  ];

  const userMood = JSON.parse(localStorage.getItem("moodData")) || {};

// Extract moods with non-zero values
const validMoods = Object.entries(userMood)
  .filter(([mood, value]) => value > 0)
  .sort((a, b) => b[1] - a[1])
  .slice(0, 2);

const topMoods = validMoods.map(([mood]) => mood);
const topInts = Object.fromEntries(validMoods);

// Retrieve previously skipped/played songs from history
let history = JSON.parse(localStorage.getItem("songHistory")) || [];

// Function to determine if a song matches user's mood
function songMatches(song) {
  const [tag1, tag2] = song.tags;
  const [int1, int2] = song.intensities;

  const tag1Match = topMoods.includes(tag1) && Math.abs((topInts[tag1] ?? 0) - int1) <= 3;
  const tag2Match = topMoods.includes(tag2) && Math.abs((topInts[tag2] ?? 0) - int2) <= 3;

  // Accept song if at least 1 tag matches with close intensity
  return tag1Match || tag2Match;
}

// Function to check if a song was already skipped/played
function isInHistory(song) {
  return history.some(h => h.name === song.name && h.file === song.file);
}

// Get songs that match mood and are not in history
let filteredSongs = songs.filter(song => songMatches(song) && !isInHistory(song));

// Fallback to all songs not in history
if (filteredSongs.length === 0) {
  filteredSongs = songs.filter(song => !isInHistory(song));
}

// Fallback to full list, and reset history
if (filteredSongs.length === 0) {
  filteredSongs = [...songs];
  history = [];
  localStorage.setItem("songHistory", JSON.stringify(history));
}

let currentSongIndex = -1;

function playRandomSong() {
  if (filteredSongs.length === 0) return;

  let nextIndex;
  do {
    nextIndex = Math.floor(Math.random() * filteredSongs.length);
  } while (nextIndex === currentSongIndex && filteredSongs.length > 1);

  currentSongIndex = nextIndex;
  const song = filteredSongs[currentSongIndex];

  // Update DOM
  document.getElementById("song-title").textContent = song.name;
  document.getElementById("mez-message").textContent = song.mez;
  document.getElementById("audio-player").src = song.file;
  document.body.style.backgroundImage = `url('${song.bg}')`;

  // Save to history
  history.push({ name: song.name, file: song.file });
  localStorage.setItem("songHistory", JSON.stringify(history));
}

function skipSong() {
  playRandomSong();
}

function dontLikeSong() {
  const dislikedSong = filteredSongs[currentSongIndex];
  filteredSongs = filteredSongs.filter(song => song.name !== dislikedSong.name || song.file !== dislikedSong.file);

  // Save disliked to history
  history.push({ name: dislikedSong.name, file: dislikedSong.file });
  localStorage.setItem("songHistory", JSON.stringify(history));

  // Fallback if list is empty
  if (filteredSongs.length === 0) {
    filteredSongs = songs.filter(song => !isInHistory(song));
    if (filteredSongs.length === 0) {
      filteredSongs = [...songs];
      history = [];
      localStorage.setItem("songHistory", JSON.stringify(history));
    }
  }

  playRandomSong();
}

function goBack() {
  window.location.href = "index.html";
}

function goHistory() {
  window.location.href = "history.html";
}

function goAllSongs() {
  const pass = prompt("Enter password to access all songs:");
  if (pass === "1911") {
    window.location.href = "songlist.html";
  } else {
    alert("Incorrect password!");
  }
}

// Initial song load
playRandomSong();
</script>
</body>
</html>
